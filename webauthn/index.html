<html>
  <head>
    <title>WebAuthN demo</title>
  </head>
  <body>
    <h1>WebAuthN demo</h1>
    <p>Hier een lijst met geldige security tokens!</p>
    <p>
      <textarea id="credentials" cols="80" rows="3"></textarea>
    </p>
    <p>
      <button onclick="registerToken();">registreer</button>
      <button onclick="validateToken();">controleer</button>
    </p>
  </body>
</html>

<script>
  function stringToArrayBuffer(str) {
    const encoder = new TextEncoder();
    return encoder.encode(str);
  }

  const username = "demo-user";
  const challenge =  stringToArrayBuffer("abcdefgh");
  const timeout = 60 * 4 * 1000;

  async function registerToken() {
    const registerResult = await window.navigator.credentials.create({
      publicKey: {
        rp: {
          id: window.location.hostname,
          name: window.location.hostname,
        },
        user: {
          displayName: username,
          id: stringToArrayBuffer(username),
          name: username,
        },
        challenge: challenge,
        pubKeyCredParams: [
          { type: "public-key", alg: -7 },
          { type: "public-key", alg: -257 },
        ],
        timeout: timeout,
        attestation: "none",
      },
    });
    document.getElementById('credentials').value = registerResult.id;
    console.log(credentials);
    return credentials;
  }
  
  function validateToken() {
    const credentials = document.getElementById('credentials').value;
    const validateResult = await window.navigator.credentials.get({
      publicKey: {
        challenge: challenge,
        timeout: timeout,
        allowCredentials: [
          {
            type: 'public-key',
            id: credentials
          }
        ]
      }
    })
    console.log({ validateResult });
  }
</script>